on:
  workflow_dispatch:
  push:
    branches:
    - main
    
jobs:
  my_job:
    name: test python and push terraform
    permissions:
      id-token: write
      contents: write
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v2
    - name: Configure AWS Credentials
      uses: aws-actions/configure-aws-credentials@master
      with:
        aws-region: ${{ secrets.AWS_SECRET_ACCESS_REGION }}
        role-to-assume: arn:aws:iam::${{ secrets.AWS_SECRET_ACCESS_ACCOUNT_ID }}:role/${{ secrets.AWS_SECRET_ACCESS_GITUB_RUNNER_ROLE }}
        role-session-name: GithubActionsSession
    - run: aws sts get-caller-identity
    - name: Setup terraform
      uses: hashicorp/setup-terraform@v2.0.3    
    - name: run plan
      run: terraform plan
    - name: run apply
      run: terraform apply -auto-approve
      
    
